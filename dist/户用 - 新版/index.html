<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ·ç”¨å®¶åº­å‚¨èƒ½-èƒ½æºç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <img src="images/logo.png" alt="AlwaysControl" class="logo-image">
            </div>
            <div class="header-center">
                <div class="date-display">
                    <svg class="date-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                    </svg>
                    <span id="currentDate">2025/11/04</span>
                </div>
                <select class="language-selector">
                    <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                    <option value="en-US">English</option>
                </select>
            </div>
        </div>
        <div class="header-actions">
            <div class="action-item">
                <svg class="action-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M10 6v8M6 10h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <div class="action-text">æ·»åŠ è®¾å¤‡</div>
            </div>
            <div class="action-item">
                <svg class="action-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M10 2a6 6 0 0 0-6 6c0 3.5-1 5-1 5h14s-1-1.5-1-5a6 6 0 0 0-6-6z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.5 17a1.5 1.5 0 0 0 3 0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <div class="action-text">ä¿¡æ¯é€šçŸ¥</div>
            </div>
            <div class="action-item">
                <svg class="action-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M10 7v3l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <div class="action-text">æ–°æ‰‹æ•™ç¨‹</div>
            </div>
        </div>
    </header>

    <!-- ä¾§è¾¹æ  -->
    <nav class="sidebar">
        <div class="user-profile">
            <div class="user-avatar">ğŸ‘¤</div>
            <div class="user-name">user_demo</div>
        </div>
        <div class="nav-menu">
            <a href="index.html" class="nav-item active">
                <div class="nav-icon">ğŸ </div>
                <span>é¦–é¡µ</span>
            </a>
            <a href="historical-data.html" class="nav-item">
                <div class="nav-icon">ğŸ“Š</div>
                <span>å†å²æ•°æ®</span>
            </a>
            <a href="message-center.html" class="nav-item">
                <div class="nav-icon">ğŸ””</div>
                <span>æ¶ˆæ¯ä¸­å¿ƒ</span>
            </a>
            <a href="help-support.html" class="nav-item">
                <div class="nav-icon">â‘¡</div>
                <span>å¸®åŠ©ä¸æ”¯æŒ</span>
            </a>
            <a href="device-management.html" class="nav-item">
                <div class="nav-icon">ğŸ¢</div>
                <span>è®¾å¤‡ç®¡ç†</span>
            </a>
            <a href="settings.html" class="nav-item">
                <div class="nav-icon">âš™ï¸</div>
                <span>è®¾ç½®</span>
            </a>
        </div>
        <div class="logout-section">
            <span class="version-text">ç‰ˆæœ¬å· 1.0.12</span>
            <a href="login.html" class="logout-btn" title="é€€å‡ºç™»å½•">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
            </a>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- ä»Šæ—¥æ•°æ®ç»Ÿè®¡ -->
        <div class="data-panel">
            <div class="panel-header">
                <div class="panel-title">ä»Šæ—¥æ•°æ®</div>
            </div>
            <div class="today-stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #ffd666 0%, #faad14 100%);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="5" stroke="white" stroke-width="2"/>
                            <path d="M12 2v2M12 20v2M2 12h2M20 12h2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" stroke="white" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">ä»Šæ—¥å‘ç”µé‡</div>
                        <div class="stat-value">29.098 <span class="stat-unit">kWh</span></div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #95de64 0%, #73d13d 100%);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">å–ç”µæ”¶ç›Š</div>
                        <div class="stat-value">88.28 <span class="stat-unit">Â¥</span></div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #69c0ff 0%, #1890ff 100%);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M19 7h-3V4H8v3H5v13h14V7zM9 18H7v-2h2v2zm0-4H7v-2h2v2zm0-4H7V8h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V8h2v2zm4 8h-2v-2h2v2zm0-4h-2v-2h2v2z" fill="white"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">å·²ä¸ºä½ èŠ‚çœ</div>
                        <div class="stat-value">79.01 <span class="stat-unit">Â¥</span></div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #87e8de 0%, #13c2c2 100%);">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L9 9l-7 .5 5.5 5L6 22l6-3.5L18 22l-1.5-7.5L22 9.5 15 9l-3-7z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">å‡å°‘ç¢³è¶³è¿¹</div>
                        <div class="stat-value">29.011 <span class="stat-unit">kg</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸­å¤®å¸ƒå±€ï¼šæˆ¿å­åœ¨ä¸­å¤®ï¼Œå·¦å³ä¸¤ä¾§æ˜¯ä¿¡æ¯å¡ç‰‡ -->
        <div class="central-layout">
            <!-- å·¦ä¾§ä¿¡æ¯å¡ç‰‡ -->
            <div class="left-panels">
                <!-- å…‰ä¼é¢æ¿ -->
                <div class="data-panel" data-panel="pv">
                    <div class="panel-header">
                        <div class="panel-title">å…‰ä¼</div>
                        <div class="status-indicator status-online">
                            <span class="status-dot"></span>
                            åœ¨çº¿
                        </div>
                    </div>
                    <div class="panel-main-value">
                        <div class="main-value-number">7.13<span class="main-value-unit">kw</span></div>
                    </div>
                    <div class="panel-detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">åŠŸç‡1</div>
                            <div class="detail-value">3.21kW</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç”µå‹1</div>
                            <div class="detail-value">400.41V</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç”µæµ1</div>
                            <div class="detail-value">8.01A</div>
                        </div>
                    </div>
                </div>

                <!-- ç”µç½‘é¢æ¿ -->
                <div class="data-panel" data-panel="grid">
                    <div class="panel-header">
                        <div class="panel-title">ç”µç½‘</div>
                        <div class="status-indicator status-online">
                            <span class="status-dot"></span>
                            åœ¨çº¿
                        </div>
                    </div>
                    <div class="panel-main-value">
                        <div class="main-value-number">0.00<span class="main-value-unit">kw</span></div>
                    </div>
                    <div class="panel-detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">åŠŸç‡</div>
                            <div class="detail-value">0.00kW</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç”µå‹</div>
                            <div class="detail-value">232.26V</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç”µæµ</div>
                            <div class="detail-value">0.00A</div>
                        </div>
                    </div>
                </div>

                <!-- å……ç”µæ¡©é¢æ¿ -->
                <div class="data-panel" data-panel="charging">
                    <div class="panel-header">
                        <div class="panel-title">å……ç”µæ¡©</div>
                        <div class="status-indicator status-online">
                            <span class="status-dot"></span>
                            åœ¨çº¿
                        </div>
                    </div>
                    <div class="panel-main-value">
                        <div class="main-value-number">2.52<span class="main-value-unit">kw</span></div>
                    </div>
                    <div class="panel-detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">åŠŸç‡1</div>
                            <div class="detail-value">2.52kW</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç”µå‹1</div>
                            <div class="detail-value">232.25V</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸­å¤®3Dæˆ¿å±‹å±•ç¤ºåŒºåŸŸ -->
            <div class="center-house">
                <div class="house-container">
                    <!-- 3Dæˆ¿å±‹æ¨¡å‹å›¾ç‰‡å®¹å™¨ -->
                    <div class="house-model">
                        <img src="images/house-model.png" alt="3D House Model" style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ä¿¡æ¯å¡ç‰‡ -->
            <div class="right-panels">
                <!-- å½“å‰å·¥ä½œæ¨¡å¼å¡ç‰‡ -->
                <div class="work-mode-card">
                    <span class="work-mode-label">å½“å‰å·¥ä½œæ¨¡å¼</span>
                    <span class="work-mode-badge">è‡ªå‘è‡ªç”¨</span>
                </div>

                <!-- å®¶åº­è´Ÿè½½é¢æ¿ -->
                <div class="data-panel" data-panel="load">
                    <div class="panel-header">
                        <div class="panel-title">å®¶åº­è´Ÿè½½</div>
                        <div class="status-indicator status-online">
                            <span class="status-dot"></span>
                            åœ¨çº¿
                        </div>
                    </div>
                    <div class="panel-main-value">
                        <div class="main-value-number">2.78<span class="main-value-unit">kw</span></div>
                    </div>
                    <div class="panel-detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">å…³é”®è´Ÿè½½</div>
                            <div class="detail-value">1.21kW</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å…³é”®ç”µå‹</div>
                            <div class="detail-value">232.22V</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æ™®é€šè´Ÿè½½</div>
                            <div class="detail-value">1.57kW</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æ™®é€šç”µå‹</div>
                            <div class="detail-value">232.26V</div>
                        </div>
                    </div>
                </div>

                <!-- ç”µæ± é¢æ¿ -->
                <div class="data-panel" data-panel="battery">
                    <div class="panel-header">
                        <div class="panel-title">ç”µæ± </div>
                        <div class="status-indicator status-online">
                            <span class="status-dot"></span>
                            åœ¨çº¿
                        </div>
                    </div>
                    <div class="panel-main-value">
                        <div class="main-value-number">1.83<span class="main-value-unit">kw(å……ç”µ)</span></div>
                    </div>
                    <div class="panel-detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">åŠŸç‡</div>
                            <div class="detail-value">1.83kW</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç”µå‹</div>
                            <div class="detail-value">57.08V</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç”µé‡(SOC)</div>
                            <div class="detail-value">32%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç”µæ± å¥åº·åº¦(SOH)</div>
                            <div class="detail-value">100%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å¹³å‡æ¸©åº¦</div>
                            <div class="detail-value">23Â°C</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è‡ªå‘è‡ªç”¨ç‡ -->
        <div class="data-panel">
            <div class="panel-header">
                <div class="panel-title">è‡ªå‘è‡ªç”¨ç‡</div>
            </div>
            <div class="usage-rate-container">
                <div class="usage-rate-table">
                    <table class="usage-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>å…‰ä¼ä¾›ç”µé‡</th>
                                <th>ç™¾åˆ†æ¯”</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="color-dot" style="background: #fadb14;"></span>ç”µæ± </td>
                                <td>10.50 kWh</td>
                                <td>18.35%</td>
                            </tr>
                            <tr>
                                <td><span class="color-dot" style="background: #52c41a;"></span>å®¶åº­æ€»è´Ÿè½½</td>
                                <td>25.20 kWh</td>
                                <td>44.05%</td>
                            </tr>
                            <tr>
                                <td><span class="color-dot" style="background: #1890ff;"></span>å……ç”µæ¡©</td>
                                <td>16.80 kWh</td>
                                <td>29.37%</td>
                            </tr>
                            <tr>
                                <td><span class="color-dot" style="background: #ff7875;"></span>ç”µç½‘</td>
                                <td>4.70 kWh</td>
                                <td>8.23%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="usage-rate-chart">
                    <div id="pieChart" class="pie-chart-wrapper"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/common.js"></script>
    <script src="js/index.js"></script>
    <script>
        // æ›´æ–°å½“å‰æ—¥æœŸ
        function updateCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const dateStr = `${year}/${month}/${day}`;
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                dateElement.textContent = dateStr;
            }
        }

        // åˆå§‹åŒ–é¥¼å›¾
        document.addEventListener('DOMContentLoaded', function() {
            // æ›´æ–°æ—¥æœŸ
            updateCurrentDate();

            // åˆå§‹åŒ–é¥¼å›¾æ•°æ® - 4ç§ç±»å‹æ•°æ®
            const pieData = [
                { label: 'ç”µæ± ', value: 18.35, color: '#fadb14' },
                { label: 'å®¶åº­æ€»è´Ÿè½½', value: 44.05, color: '#52c41a' },
                { label: 'å……ç”µæ¡©', value: 29.37, color: '#1890ff' },
                { label: 'ç”µç½‘', value: 8.23, color: '#ff7875' }
            ];

            // æ£€æŸ¥ChartManageræ˜¯å¦å­˜åœ¨
            if (typeof ChartManager !== 'undefined') {
                ChartManager.init('pieChart');
                ChartManager.drawPieChart('pieChart', pieData);
            } else {
                // ç¯å½¢å›¾è®¾è®¡ - å‚ç…§å½•å±è§†é¢‘,æ·»åŠ é¼ æ ‡æ‚¬åœäº¤äº’
                const pieContainer = document.getElementById('pieChart');
                if (pieContainer) {
                    let total = pieData.reduce((sum, item) => sum + item.value, 0);
                    let currentAngle = -90; // ä»é¡¶éƒ¨(12ç‚¹é’Ÿæ–¹å‘)å¼€å§‹
                    let svgPaths = '';

                    pieData.forEach((item, index) => {
                        const percentage = item.value / total;
                        const angle = percentage * 360;
                        const largeArcFlag = angle > 180 ? 1 : 0;

                        const startAngle = currentAngle * Math.PI / 180;
                        const endAngle = (currentAngle + angle) * Math.PI / 180;

                        // å¤–åœˆåæ ‡ (åŠå¾„85)
                        const outerRadius = 85;
                        const x1Outer = 100 + outerRadius * Math.cos(startAngle);
                        const y1Outer = 100 + outerRadius * Math.sin(startAngle);
                        const x2Outer = 100 + outerRadius * Math.cos(endAngle);
                        const y2Outer = 100 + outerRadius * Math.sin(endAngle);

                        // å†…åœˆåæ ‡ (åŠå¾„55,å½¢æˆç¯å½¢)
                        const innerRadius = 55;
                        const x1Inner = 100 + innerRadius * Math.cos(startAngle);
                        const y1Inner = 100 + innerRadius * Math.sin(startAngle);
                        const x2Inner = 100 + innerRadius * Math.cos(endAngle);
                        const y2Inner = 100 + innerRadius * Math.sin(endAngle);

                        // ç»˜åˆ¶ç¯å½¢æ‰‡å½¢ - ä½¿ç”¨ä¸¤ä¸ªå¼§çº¿æ„æˆç¯å½¢
                        svgPaths += `
                            <path d="M${x1Outer},${y1Outer}
                                     A${outerRadius},${outerRadius} 0 ${largeArcFlag},1 ${x2Outer},${y2Outer}
                                     L${x2Inner},${y2Inner}
                                     A${innerRadius},${innerRadius} 0 ${largeArcFlag},0 ${x1Inner},${y1Inner}
                                     Z"
                                  fill="${item.color}"
                                  opacity="0.85"
                                  stroke="white"
                                  stroke-width="2"
                                  class="ring-segment"
                                  data-label="${item.label}"
                                  data-value="${item.value}"
                                  style="cursor: pointer; transition: opacity 0.3s, transform 0.3s;"
                                  onmouseover="this.setAttribute('opacity', '1'); this.style.transform='scale(1.05)'; this.style.transformOrigin='100px 100px';"
                                  onmouseout="this.setAttribute('opacity', '0.85'); this.style.transform='scale(1)';"
                                  onclick="showSegmentInfo('${item.label}', ${item.value})"/>
                        `;

                        currentAngle += angle;
                    });

                    pieContainer.innerHTML = `
                        <svg viewBox="0 0 200 200" style="width: 100%; height: 100%;">
                            ${svgPaths}
                            <!-- ä¸­å¿ƒæ–‡å­— -->
                            <text id="centerText" x="100" y="105" text-anchor="middle" font-size="32" fill="#52c41a" font-weight="700">100%</text>
                        </svg>
                    `;

                    // æ·»åŠ é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
                    pieContainer.querySelectorAll('.ring-segment').forEach(segment => {
                        const label = segment.getAttribute('data-label');
                        const value = segment.getAttribute('data-value');
                        const centerText = document.getElementById('centerText');

                        segment.addEventListener('mouseenter', function() {
                            centerText.textContent = `${label}`;
                            centerText.setAttribute('font-size', '16');
                            centerText.setAttribute('y', '95');

                            // æ·»åŠ ç™¾åˆ†æ¯”æ–‡å­—
                            const percentText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                            percentText.setAttribute('id', 'percentText');
                            percentText.setAttribute('x', '100');
                            percentText.setAttribute('y', '115');
                            percentText.setAttribute('text-anchor', 'middle');
                            percentText.setAttribute('font-size', '24');
                            percentText.setAttribute('fill', '#333');
                            percentText.setAttribute('font-weight', '700');
                            percentText.textContent = `${value}%`;
                            this.parentElement.appendChild(percentText);
                        });

                        segment.addEventListener('mouseleave', function() {
                            centerText.textContent = '100%';
                            centerText.setAttribute('font-size', '32');
                            centerText.setAttribute('y', '105');

                            // ç§»é™¤ç™¾åˆ†æ¯”æ–‡å­—
                            const percentText = document.getElementById('percentText');
                            if (percentText) {
                                percentText.remove();
                            }
                        });
                    });
                }

                // ç‚¹å‡»æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯çš„å‡½æ•°
                window.showSegmentInfo = function(label, value) {
                    console.log(`${label}: ${value}%`);
                };
            }
        });
    </script>
</body>
</html>
